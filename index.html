<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nicolás Martinez 3D</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;800&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="./favicon.png">
    <style>
        body { margin: 0; background-color: #050505; color: white; font-family: 'Montserrat', sans-serif; overflow: hidden; }

        ::selection {
        background-color: #cc9933;
        color: white;
        }
        
        canvas { position: fixed; top: 0; left: 0; z-index: 1; outline: none; cursor: grab; }
        canvas:active { cursor: grabbing; }

        .vignette {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 5; 
            pointer-events: none; background: transparent; transition: box-shadow 0.6s ease;
        }

        .progress-container {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: 150px; height: 3px; background: rgba(255, 255, 255, 0.1);
            border-radius: 2px; z-index: 25; overflow: hidden;
        }
        .progress-fill {
            height: 100%; width: 0%; background: rgba(255, 255, 255, 0.8);
            transition: width 0.8s cubic-bezier(0.25, 1, 0.5, 1);
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        #text-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; display: flex; justify-content: center; align-items: center;
            z-index: 10; perspective: 1000px;
        }
        .slide {
            position: absolute; text-align: center;
            transition: all 1.2s cubic-bezier(0.19, 1, 0.22, 1);
            opacity: 0; transform: scale(0.5) translateZ(-200px); filter: blur(10px);
        }
        .slide.active { opacity: 1; transform: scale(1) translateZ(0); filter: blur(0); z-index: 12; }
        .slide.prev { opacity: 0; transform: scale(1.5) translateZ(200px); filter: blur(5px); }
        
        h1 { font-size: 5rem; text-transform: uppercase; margin: 0; text-shadow: 0 10px 40px rgba(0,0,0,0.8); }
        p { font-size: 1.5rem; letter-spacing: 0.5px; margin-top: 5px; opacity: 0.8; }

        .corner-btn {
            position: fixed; z-index: 20; font-weight: 400; text-transform: uppercase;
            font-size: 0.8rem; letter-spacing: 1px; cursor: pointer; opacity: 0.6;
            transition: all 0.3s; padding: 40px; 
        }
        .corner-btn:hover { opacity: 1; text-shadow: 0 0 10px rgba(255,255,255,0.5); }
        .top-left { top: 0; left: 0; }
        .top-right { top: 0; right: 0; }
        .bottom-left { bottom: 0; left: 0; }
        .bottom-right { bottom: 0; right: 0; }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.25); backdrop-filter: blur(15px); z-index: 30;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.5s ease;
        }
        .modal-overlay.open { opacity: 1; pointer-events: all; }
        .modal-content {
            width: 60%; max-width: 800px; background: rgba(255, 255, 255, 0.075);
            border: 1px solid rgba(255,255,255,0.1); padding: 60px; border-radius: 20px;
            text-align: center; transform: scale(0.9); transition: transform 0.5s cubic-bezier(0.2, 1, 0.3, 1);
        }
        .modal-overlay.open .modal-content { transform: scale(1); }
        .modal-close { position: absolute; top: 20px; right: 20px; font-size: 2rem; cursor: pointer; opacity: 0.5; }
        .modal-close:hover { opacity: 1; }
        .modal-title { font-size: 3.5rem; margin-bottom: 20px; text-transform: uppercase; }
        .modal-body { font-size: 1.2rem; line-height: 1.6; color: #ddd; }
        .modal-body a { color: white; text-decoration: underline; }

        @media (max-width: 768px) { h1 { font-size: 3rem; } .modal-content { width: 90%; padding: 30px; } .corner-btn { padding: 20px; font-size: 0.7rem; } }
    </style>
</head>
<body>

    <canvas id="bg"></canvas>
    <div class="vignette"></div>

    <div class="progress-container">
        <div class="progress-fill"></div>
    </div>

    <div class="corner-btn top-left" data-target="about">¿Quién soy?</div>
    <div class="corner-btn top-right" data-target="services">¿Qué hago?</div>
    <div class="corner-btn bottom-left" data-target="works">Portfolio</div>
    <div class="corner-btn bottom-right" data-target="contact">Contacto</div>

    <div id="text-container">
        <div class="slide active" id="slide-0"><h1>¡Hola!</h1><p>Bienvenido a mi web</p></div>
        <div class="slide" id="slide-1"><h1>Soy Nico</h1><p>Diseñador y Desarrollador</p></div>
        <div class="slide" id="slide-2"><h1>Hago</h1><p>Sitios Web 3D</p></div>
        <div class="slide" id="slide-3"><h1>Contactame</h1><p>Hagamos el tuyo</p></div>
    </div>

    <div class="modal-overlay">
        <div class="modal-content">
            <div class="modal-close">&times;</div>
            <h2 class="modal-title" id="m-title">Título</h2>
            <div class="modal-body" id="m-body">...</div>
        </div>
    </div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js", "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/" } }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x050505, 0.05);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: document.querySelector('#bg'), antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        camera.position.z = 4.5;

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true; controls.dampingFactor = 0.05;
        controls.enableZoom = false; controls.autoRotate = true; controls.autoRotateSpeed = 1.0;

        // --- FUNCIÓN PARA CREAR CÍRCULOS (Textura) ---
        function createCircleTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 32; canvas.height = 32;
            const ctx = canvas.getContext('2d');
            
            // Dibujamos un círculo blanco difuminado
            const gradient = ctx.createRadialGradient(16, 16, 0, 16, 16, 16);
            gradient.addColorStop(0, 'rgba(255,255,255,1)');
            gradient.addColorStop(1, 'rgba(255,255,255,0)');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0,0,32,32);

            const texture = new THREE.CanvasTexture(canvas);
            return texture;
        }

        // MAGMA
        const geometry = new THREE.IcosahedronGeometry(1.4, 90);
        const presets = [
            { color: new THREE.Color('#cc9933'), density: 0.6, strength: 0.3 }, 
            { color: new THREE.Color('#00ffaa'), density: 2.0, strength: 0.7 }, 
            { color: new THREE.Color('#2266ff'), density: 0.9, strength: 0.4 }, 
            { color: new THREE.Color('#ff0040'), density: 3.0, strength: 1.0 }  
        ];

        let currentValues = { ...presets[0] };
        let targetScale = 1.0;
        let baseScale = 1.0;

        const material = new THREE.ShaderMaterial({
            uniforms: {
                u_time: { value: 0.0 },
                u_color: { value: new THREE.Color('#cc9933') },
                u_density: { value: 0.6 },
                u_strength: { value: 0.3 }
            },
            vertexShader: `
                uniform float u_time; uniform float u_density; uniform float u_strength;
                varying vec3 vNormal;
                vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}
                vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}
                vec4 permute(vec4 x){return mod289(((x*34.0)+1.0)*x);}
                vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}
                float snoise(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}
                void main() { vNormal = normal; float noise = snoise(position * u_density + u_time); vec3 newPos = position + (normal * noise * u_strength); gl_Position = projectionMatrix * modelViewMatrix * vec4(newPos, 1.0); }
            `,
            fragmentShader: `
                uniform vec3 u_color; varying vec3 vNormal;
                void main() { vec3 viewDir = vec3(0.0, 0.0, 1.0); float fresnel = pow(1.0 - dot(vNormal, viewDir), 2.0); vec3 color = mix(u_color * 0.1, u_color * 1.5, fresnel); gl_FragColor = vec4(color, 1.0); }
            `
        });
        const blob = new THREE.Mesh(geometry, material);
        scene.add(blob);

        // --- SISTEMA DE PARTÍCULAS (AHORA SON ESFERAS) ---
        const particlesGeometry = new THREE.BufferGeometry();
        const particlesCount = 1000;
        const posArray = new Float32Array(particlesCount * 3);

        for(let i = 0; i < particlesCount * 3; i++) {
            posArray[i] = (Math.random() - 0.5) * 15; 
        }
        particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));

        // Creamos la textura circular
        const circleTexture = createCircleTexture();

        const particlesMaterial = new THREE.PointsMaterial({
            size: 0.05, // Un poco más grande para que se note la forma
            map: circleTexture, // AQUÍ APLICAMOS LA FORMA REDONDA
            transparent: true,
            opacity: 0.6,
            depthWrite: false, // Mejor mezcla con el fondo
            blending: THREE.AdditiveBlending
        });

        const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
        scene.add(particlesMesh);


        // --- NAVEGACIÓN ---
        let currentSlide = 0;
        let isMoving = false;
        const totalSlides = 4;
        const vignette = document.querySelector('.vignette');
        const progressFill = document.querySelector('.progress-fill');

        function changeSlide(direction) {
            if(isMoving) return;
            
            let next = currentSlide + direction;
            if(next >= totalSlides) next = 0;
            if(next < 0) next = totalSlides - 1;

            isMoving = true;

            const currEl = document.getElementById(`slide-${currentSlide}`);
            const nextEl = document.getElementById(`slide-${next}`);

            currEl.classList.remove('active'); currEl.classList.add('prev');
            nextEl.classList.remove('prev'); nextEl.classList.add('active');

            currentSlide = next;
            targetScale = 1.3;

            const progress = (currentSlide / (totalSlides - 1)) * 100;
            progressFill.style.width = `${progress}%`;

            setTimeout(() => {
                isMoving = false;
                targetScale = 1.0;
                document.querySelectorAll('.slide').forEach((el, i) => {
                    if(i !== currentSlide) el.classList.remove('prev');
                });
            }, 1000);
        }

        window.addEventListener('wheel', (e) => {
            if(document.querySelector('.modal-overlay.open')) return;
            if(e.deltaY > 0) changeSlide(1);
            else changeSlide(-1);
        });

        let touchStartY = 0;
        window.addEventListener('touchstart', e => touchStartY = e.touches[0].clientY);
        window.addEventListener('touchend', e => {
            const touchEndY = e.changedTouches[0].clientY;
            if(touchStartY - touchEndY > 50) changeSlide(1); 
            if(touchEndY - touchStartY > 50) changeSlide(-1);
        });

        const modalData = {
            'about': { title: '¿Quién soy?', text: 'Soy un diseñador y desarrollador apasionado por crear experiencias inmersivas.' },
            'services': { title: '¿Qué hago?', text: 'Desarrollo Web 3D<br>Animación y Modelado 3D<br>Diseño Gráfico' },
            'works': { title: 'Mis Trabajos', text: 'He colaborado muchas marcas para transformar sus identidades digitales.<br>Este es mi <a href="https://nicomartinez.myportfolio.com/" target="_blank" style="color:white;">Portfolio</a>' },
            'contact': { title: 'Contacto', text: 'Email: nico.a.marti@gmail.com<br>Teléfono: <a href="http://wa.me//+5492477364026" target="_blank" style="color:white;">+5492477364026</a><br>IG: <a href="https://www.instagram.com/nicomartinezdg/" target="_blank" style="color:white;">@nicomartinezdg</a>' }
        };
        const modalOverlay = document.querySelector('.modal-overlay');
        const modalTitle = document.getElementById('m-title');
        const modalBody = document.getElementById('m-body');
        const closeBtn = document.querySelector('.modal-close');

        document.querySelectorAll('.corner-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const key = btn.getAttribute('data-target');
                if(modalData[key]) {
                    modalTitle.innerHTML = modalData[key].title;
                    modalBody.innerHTML = modalData[key].text;
                    modalOverlay.classList.add('open');
                    controls.autoRotate = false;
                }
            });
        });
        function closeModal() { modalOverlay.classList.remove('open'); controls.autoRotate = true; }
        closeBtn.addEventListener('click', closeModal);
        modalOverlay.addEventListener('click', (e) => { if(e.target === modalOverlay) closeModal(); });

        const canvas = document.querySelector('canvas');
        canvas.addEventListener('mousedown', () => targetScale = 1.3);
        canvas.addEventListener('mouseup', () => targetScale = 1.0);
        
        // LOOP ANIMACIÓN
        const clock = new THREE.Clock();
        const lerp = (a, b, t) => a + (b - a) * t;

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            const time = clock.getElapsedTime();
            const preset = presets[currentSlide];

            material.uniforms.u_color.value.lerp(preset.color, 0.05);
            currentValues.density = lerp(currentValues.density, preset.density, 0.05);
            currentValues.strength = lerp(currentValues.strength, preset.strength, 0.05);
            material.uniforms.u_density.value = currentValues.density;
            material.uniforms.u_strength.value = currentValues.strength;
            material.uniforms.u_time.value = time * 0.4;

            baseScale = lerp(baseScale, targetScale, 0.1);
            blob.scale.setScalar(baseScale);

            // VIGNETTE BOX-SHADOW
            const r = Math.floor(material.uniforms.u_color.value.r * 255);
            const g = Math.floor(material.uniforms.u_color.value.g * 255);
            const b = Math.floor(material.uniforms.u_color.value.b * 255);
            vignette.style.boxShadow = `inset 0 0 450px rgba(${r},${g},${b}, 0.35)`;

            // PARTICULAS
            particlesMesh.rotation.y = time * 0.05;
            particlesMesh.rotation.x = time * 0.02;
            particlesMaterial.color.copy(material.uniforms.u_color.value);

            renderer.render(scene, camera);
        }
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        animate();
    </script>
</body>
</html>


